<?xml version="1.0" encoding="UTF-8"?>
<project name="dbside" basedir="." default="rebuild">
    <property file="db.properties"/>

    <path id="project.classpath">
        <fileset dir="lib" includes="*.jar"/>
        <pathelement location="."/>
    </path>
    <taskdef resource="net/sf/dbdeploy/ant/task.properties" classpathref="project.classpath"/>


    <target name="rebuild" depends="clean,init"/>

    <target name="init">
        <exec classpathref="project.classpath"
             driver="${jdbc.driver}"
             url="${jdbc.url}"
             userid="${jdbc.username}"
             password="${jdbc.password}"
             onerror="continue">
            <path>
                <fileset dir="scripts/init" includes="*.sql"/>
            </path>
        </exec>
    </target>

    <target name="clean">
        <exec classpathref="project.classpath"
             driver="${jdbc.driver}"
             url="${jdbc.url}"
             userid="${jdbc.username}"
             password="${jdbc.password}"
             onerror="continue">
            <fileset dir="scripts/clean" includes="*.sql"/>
        </exec>
    </target>

    <target name="migrate">
        <delete>
            <fileset dir="." includes="**/*.bak"/>
        </delete>
        <delete dir="build"/>
        <mkdir dir="build"/>
        <migrate driver="${jdbc.driver}"
                  url="${jdbc.url}"
                  userid="${jdbc.username}"
                  password="${jdbc.password}"
                  dir="scripts/deltas"
                  outputfile="build/output.sql"
                  dbms="${jdbc.dbms}"
                  deltaset="TEST"
                  undoOutputfile="build/undo.sql"
                  lastChangeToApply="${version}"/>
        <exec classpathref="project.classpath"
             driver="${jdbc.driver}"
             url="${jdbc.url}"
             userid="${jdbc.username}"
             password="${jdbc.password}"
             src="build/output.sql"
             onerror="continue"/>
    </target>

    <target name="rollback">
        <delete>
            <fileset dir="." includes="**/*.bak"/>
        </delete>
        <delete dir="build"/>
        <mkdir dir="build"/>
        <rollback driver="${jdbc.driver}"
                  url="${jdbc.url}"
                  userid="${jdbc.username}"
                  password="${jdbc.password}"
                  dir="scripts/deltas"
                  outputfile="build/output.sql"
                  dbms="${jdbc.dbms}"
                  deltaset="TEST"
                  undoOutputfile="build/undo.sql"
                  lastChangeToApply="${version}"/>
        <exec classpathref="project.classpath"
             driver="${jdbc.driver}"
             url="${jdbc.url}"
             userid="${jdbc.username}"
             password="${jdbc.password}"
             src="build/undo.sql"
             onerror="continue"/>
    </target>

    <target name="view">
        <delete>
            <fileset dir="." includes="**/*.bak"/>
        </delete>
        <delete dir="build"/>
        <mkdir dir="build"/>
        <view driver="${jdbc.driver}"
              url="${jdbc.url}"
              userid="${jdbc.username}"
              password="${jdbc.password}"
              dir="scripts/deltas"
              outputfile="build/output.sql"
              dbms="${jdbc.dbms}"
              deltaset="TEST"
              undoOutputfile="build/undo.sql"
              lastChangeToApply="${version}"/>
    </target>

</project>
